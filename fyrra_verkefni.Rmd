---
author: Eygló Ástþórsdóttir og Helga Björg Helgadóttir
date: 19. feb 2025
title: "Fyrra R verkefni"
output: 
  rmdformats::downcute:
    code_folding: show
    self_contained: true
    thumbnails: false
    lightbox: true
  pkgdown:
    as_is: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r}
library(tidyverse)  # Fyrir gagnavinnslu
library(readr)      # Fyrir gagnainnlestur
library(dplyr)
library(ggplot2)    # Búa til gröf
library(knitr)      # Kable-töflur sem eru fallegri
library(scales)     # Format á tölur
install.packages("kableExtra")
library(kableExtra)
library(tidyr)
library(stringr)
```

# HLUTI 1
## a) 
**Lesið gagnasafnið inn í R/RStudio og geymið í hlut sem ber upphafsstafi þeirra sem verkefnið vinna (ef Gréta Halldórsdóttir og Sigurður Karl Jónsson eru að vinna saman skulu þau nefna hlutinn gs).**
```{r}
eh <- read_csv("https://ahj.hi.is/survey_results_public_rev.csv")
```

## b) 
**Notið filter() skipunina til að velja svör frá starfandi forriturum (sjá MainBranch breytunna, "I am a developer by profession") í fullri vinnu (sjá Employment breytuna, "Employed, full-time"). Yfirskrifið stóra gagnaramman í a) lið.**
```{r}
eh <- eh %>%
  filter(MainBranch == "I am a developer by profession" &
         Employment == "Employed, full-time")
```

## c) 
**Búið til nýja breytu í gagnarammanum ykkar sem inniheldur fjölda ára sem svarendur höfðu kóðað áður en þau fóru að vinna sem forritarar. Er eitthvað athugavert við gildin á þeirri breytu?**
```{r}
eh <- eh %>%
  mutate(YearsCodingBeforeDev = as.numeric(YearsCode) - as.numeric(YearsCodePro))

summary(eh$YearsCodingBeforeDev)
```
Samkvæmt þessum upplýsingum hefur a.m.k. einn einstaklingur skráð að hann hafi starfað sem forritari lengur heldur en hann hefur forritað. Þetta sést því mismunurinn er í mínus. Þetta er ekki hægt. Skoðum hversu margir einstaklingar hafa skráð upplýsingarnar sínar vitlaust á þessa vegu:

```{r}
sum(eh$YearsCodingBeforeDev < 0, na.rm = TRUE)
```

265 einstaklingar eru með skráð að þeir hafi starfað sem forritari amk einu ári lengur en þeir hafa forritað, sem stemmir ekki. Filterum út þá sem misskildu spurninguna:

```{r}
eh_fixedYears <- eh %>% 
  filter(YearsCodingBeforeDev >= 0)
summary(eh_fixedYears$YearsCodingBeforeDev)
```

Þá fáum við mun raunsærri gildi.

## d) 
**Veljið svör frá fólki sem gefur launin sín upp í Evrum eða Dollurum (USD). Notið aðeins svör frá þessum einstaklingum það sem eftir er verkefnisins (yfirskrifið ramman frá því í b) lið).**
```{r}
eh$Currency <- substr(eh$Currency, 1, 3)
eh <- eh %>% filter(Currency %in% c("EUR", "USD"))
```

## e) 
**Skoðið CompTotal breytuna. Eru einhverjir augljósir útlagar í breytunni? Ef svo, hvert/hver eru gildin? Fjarlægið þessa auljósu útlaga. Yfirskrifið gamla rammann.**
```{r}
# Passa að CompTotal sé tala
eh$CompTotal <- as.numeric(eh$CompTotal)

# Filtera út NA gildi
eh <- eh %>% filter(!is.na(CompTotal))

# Reikna IQR og filtera út útlaga
Q1 <- quantile(eh$CompTotal, 0.25, na.rm = TRUE)
Q3 <- quantile(eh$CompTotal, 0.75, na.rm = TRUE)
IQR_value <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR_value
upper_bound <- Q3 + 1.5 * IQR_value
eh <- eh %>% filter(CompTotal >= lower_bound & CompTotal <= upper_bound)

# Birta uppfærðu gögnin í CompTotal
summary(eh$CompTotal)

```

## f) 
**Búið til nýja breytu sem heitir CompTotalUSD þar sem öll laun eru í dollurum. Ábending: Hér gæti verið gott að nota ifelse() skipun.**
```{r}
eh$CompTotalUSD <- ifelse(eh$Currency == "USD", eh$CompTotal,
                          ifelse(eh$Currency == "EUR", eh$CompTotal * 1.08, NA))  

summary(eh$CompTotalUSD)
eh %>% select(Currency, CompTotal, CompTotalUSD) %>% head(10)

```

## g) 
**Sýnið fjölda svara frá hverju og einu landi frá þeim 10 löndum sem flest svörin koma frá.**
```{r}
# Telja fjölda svara frá hverju landi
country_counts <- eh %>%
  count(Country, sort = TRUE)

# Finna topp 10 löndin
top_10_countries <- head(country_counts, 10)

# Birta niðurstöður
top_10_countries

```


## h) 
**Veljið forritara frá þremur löndum til að vinna áfram með. Það þurfa að vera a.m.k. 300 svör frá þeim löndum sem þið vinnið með. Yfirskrifið gagnaramman í e) lið með svörum frá þessum þremur löndum. Þið eigið að nota þennan gagnaramma það sem eftir er verkefnisins.**
```{r}
countries_over_300 <- country_counts %>% filter(n >= 300)

selected_countries <- c("United States of America", "Germany", "France")

# Yfirskrifa gagnarammann með svörum frá þessum löndum
eh <- eh %>% filter(Country %in% selected_countries)
```

## i) 
**Kannið hvort að þær breytur sem þið munið nota í verkefninu séu rétt skráðar (talnabreytur eða flokkabreytur). Breytið þeim flokkabreytum sem þið ætlið að nota í factor breytur ef þær eru skráðar sem chr (þið gætuð þurft að koma aftur að þessum lið síðar í verkefninu þegar þið eruð búin að ákveða hvaða breytur þið ætlið að vinna með).**
```{r}
eh$YearsCode <- as.numeric(eh$YearsCode)
eh$YearsCodePro <- as.numeric(eh$YearsCodePro)
eh$CompTotal <- as.numeric(eh$CompTotal)
eh$CompTotalUSD <- as.numeric(eh$CompTotalUSD)

eh$Country <- as.factor(eh$Country)
eh$EdLevel <- as.factor(eh$EdLevel)
eh$Employment <- as.factor(eh$Employment)
eh$RemoteWork <- as.factor(eh$RemoteWork)
eh$OrgSize <- as.factor(eh$OrgSize)
eh$DevType <- as.factor(eh$DevType)
eh$MainBranch <- as.factor(eh$MainBranch)
```

## j) 
**Endurskýrið flokkana í EdLevel breytunni þannig að nöfnin verði styttri og á íslensku. Endurskýrið einnig nöfnin á löndunum þannig að þau verði á íslensku.**
```{r}
eh$EdLevel <- recode(eh$EdLevel,
  "Primary/elementary school" = "Grunnskólapróf",
  "Secondary school (e.g. American high school, German Realschule or Gymnasium, etc.)" = "Framhaldsskólapróf",
  "Some college/university study without earning a degree" = "Háskólanám án gráðu",
  "Associate degree (A.A., A.S., etc.)" = "Diplóma",
  "Bachelor’s degree (B.A., B.S., B.Eng., etc.)" = "Bakkalárgráða",
  "Master’s degree (M.A., M.S., M.Eng., MBA, etc.)" = "Meistaragráða",
  "Professional degree (JD, MD, Ph.D, Ed.D, etc.)" = "Doktorspróf",
  "Something else" = "Annað"
)
# Skilgreina rétta röð fyrir menntastigin
education_levels_order <- c("Grunnskólapróf", "Framhaldsskólapróf", "Háskólanám án gráðu", "Diplóma", "Bakkalárgráða", "Meistaragráða", "Doktorspróf", "Annað")

# Raða menntastigunum
eh$EdLevel <- factor(eh$EdLevel, levels = education_levels_order)

# Skoða menntastigin í töflu
kable(table(eh$EdLevel), col.names = c("Menntunarstig", "Fjöldi svarenda"))
```
```{r}
eh$Country <- recode(eh$Country,
                     "United States of America" = "Bandaríkin",
                     "Germany" = "Þýskaland",
                     "France" = "Frakkland")
kable(table(eh$Country), col.names = c("Land", "Fjöldi svarenda"))
```

# HLUTI 2
## k) 
**Notið viðeigandi myndrit sem sýnir árslaun svarenda í dollurum (USD). Lýsið í örfáum orðum því sem þið sjáið á myndinni. Hér gæti verið góð hugmynd að fjarlægja einhver svör. Rökstyðjið af hverju þið ákváðuð að gera það og teiknið sams konar mynd aftur (eftir að þið fjarlægið).**
```{r}
launsvarenda <- ggplot(eh, aes(x = CompTotalUSD)) + 
  geom_histogram(bins = 30, fill="steelblue", color="black") +
  labs(title = "Árslaun í dollurum (USD)", x = "Árslaun (USD)", y = "Fjöldi svarenda") +
  scale_y_continuous(breaks = seq(0, 500, by = 100)) +
  scale_x_continuous(labels = scales::comma, 
                     breaks = seq(min(eh$CompTotalUSD),
                                  max(eh$CompTotalUSD), 
                                  by = 50000)) +
  theme_minimal()

launsvarenda
```

## l) 
**Notið viðeigandi myndrit sem sýnir árslaun þátttakenda í USD eftir löndunum þremur. Lýsið í örfáum orðum því sem þið sjáið á myndinni.**
```{r}
launLanda <- ggplot(eh, aes(x = Country, y = CompTotalUSD, fill = Country)) +
  geom_boxplot(outlier.color = "red", outlier.shape = 16) +
  labs(title = "Árslaun þátttakenda í dollurum (USD) eftir hverju landi", 
       y = "Árslaun (USD)", 
       x = "Land") +
  scale_y_continuous(labels = scales::comma, 
                     breaks = seq(min(eh$CompTotalUSD),
                                  max(eh$CompTotalUSD), 
                                  50000)) +
  theme_minimal()

launLanda
```

## m) 
**Nú skuluð þið aftur notað viðeigandi myndrit til að sýna árslaun þátttakenda eftir löndunum þremur en nú einnig menntun. Lýsið í örfáum orðum því sem þið sjáið á myndinni. Ábending: notið facet_wrap().**
```{r}
annual_salaries_by_country_education <- ggplot(eh, aes(x = EdLevel, y = CompTotalUSD)) +
  geom_boxplot(fill = "steelblue", color = "black") +
  labs(title = "Árslaun í dollurum (USD) eftir löndum og menntun", x = "Menntun", y = "Árslaun (USD)") +
  theme_minimal() +
  facet_wrap(~ Country) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = comma)

annual_salaries_by_country_education
```

## n) 
**Veljið ykkur tvær talnabreytur sem ykkur finnst spennandi að skoða saman og búið til viðeigandi myndrit sem sýnir þær. Lýsið í örfáum orðum því sem þið sjáið á myndinni.**

```{r}
codeing_years_pro_and_salary <- ggplot(
  # breytan data er fenginn með hjálp frá ai
  data = eh %>% 
    filter(!is.na(YearsCodePro),
           !is.na(CompTotalUSD),               # Engin laun sem eru NA
           CompTotalUSD > 0),                   # Engin núlllaun
  aes(x = YearsCodePro, y = CompTotalUSD, color = YearsCodePro)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  scale_color_gradient(low = "lightpink", high = "blue") +
  labs(title = "Samband reynsluár í forritun og árslauna (USD)",
       x = "Ár sem atvinnuforritari (YearsCodePro)",
       y = "Árslaun í USD (CompTotalUSD)") +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal()
codeing_years_pro_and_salary
```

### Hvað sjáum við út frá þessari mynd

**Hallatala:** Línan hallar upp á við, sem bendir til jákvæðs sambands milli atvinnureynslu í forritun og árslauna. Þó þó nokkur breidd sé í gögnunum.

**Mikið bil í launum:** Hægt er að sjá fólk með stuttan starfsaldur (0–10 ár) á mjög fjölbreyttum launum, upp í 200þ USD og meira.

**StarfsAldur:** Nokkrir sem hafa starfað lengi (20+ ár) eru samt með meðal- eða lægri laun en sumir sem hafa starfað styttra, sem sýnir að sambandið er ekki sterkt og laun geta ráðist af mörgum þáttum

## o) 
**Veljið ykkur talnabreytu og flokkabreytu sem ykkur finnst spennandi að skoða saman og búið til viðeigandi myndrit sem sýnir þær. Lýsið í örfáum orðum því sem þið sjáið á myndinni.**
```{r}
# Reikna út 10 algengustu DevType gildi
top_10_devtypes <- eh %>%
  count(DevType, sort = TRUE) %>%
  slice_head(n = 10)

# Sía úr eh þeim raðir sem eru í top 10 DevType
eh_dev_top10 <- eh %>%
  filter(DevType %in% top_10_devtypes$DevType)

# Skilgreina viðeigandi röð fyrir DevType
development_order <- c("Developer, back-end", 
                       "Developer, front-end", 
                       "Developer, full-stack", 
                       "Developer, mobile", 
                       "Developer, embedded applications or devices", 
                       "Developer, desktop or enterprise applications", 
                       "Engineering manager", 
                       "Data scientist or machine learning specialist", 
                       "Data engineer",
                       "Other (please specify):")

# Endurraða DevType samkvæmt development_order
eh_dev_top10 <- eh_dev_top10 %>%
  mutate(DevType = factor(DevType, levels = development_order))

# Teikna boxplotið
dev_type_and_years_coding <- ggplot(eh_dev_top10, aes(x = DevType, y = YearsCode)) +
  geom_boxplot(outlier.color = "red") +
  labs(
    title = "Samanburður á DevType og YearsCode",
    x = "Tegund forritara (DevType)",
    y = "Ár sem forritari (YearsCode)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

dev_type_and_years_coding

```

### Hvað sjáum við út frá þessari mynd?

**Breidd:** Allir flokkar hafa talsverða breidd í árafjölda. Sumir hafa starfað stutt en aðrir mjög lengi.

**Miðgildin:** Miðgildin eru svipuð í nokkrum flokkum (t.d. front-end“, back-end“, full-stack“), en sumir flokkar eins og Engineering manager virðast með pinku hærri miðgildi.

**Útlagar:** Margir rauðir punktar benda til þess að þótt flestir séu með nokkra ára reynslu, séu alltaf einstaklingar sem hafa miklu lengri reynslu en aðrir – eða mjög styttri. 

# HLUTI 3
## p) 
**Búið til töflu sem sýnir fjölda svarenda eftir löndum og menntun.**
```{r}
fjoldi_svarenda_tafla <- table(eh$EdLevel, eh$Country)

# Birta töflu
kable(fjoldi_svarenda_tafla, caption = "<center>Fjöldi svarenda eftir löndum og menntun</center>", format = "html", align = "c") %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

## q) 
**Búið til töflu sem sýnir hlutfall svarenda á hverju menntunarstigi fyrir sig eftir löndum. Það á t.d. að vera hægt að lesa hversu hátt hlutfall svarenda er með BS gráðu í hverju landi fyrir sig osfrv.**

```{r}
hlutfall_svarenda_tafla <- eh %>%
  group_by(Country, EdLevel) %>%
  summarise(fjoldi = n(), .groups = "drop") %>%
  group_by(EdLevel) %>%
  mutate(hlutfall = fjoldi / sum(fjoldi)) %>%
  select(Country, EdLevel, hlutfall) %>%
  pivot_wider(names_from = Country, values_from = hlutfall)

hlutfall_svarenda_tafla <- hlutfall_svarenda_tafla %>%
  mutate(across(where(is.numeric), ~ percent(., accuracy = 0.1)))

colnames(hlutfall_svarenda_tafla)[1] <- ""

# Birta töflu
kable(hlutfall_svarenda_tafla, format = "html", align = "c") %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

## r) 
**Búið til töflu sem sýnir meðalárslaun, miðgildi árslauna og staðalfrávik árslauna eftir menntun og löndum. Í tölflunni á einnig að koma fram hvað eru margar mælingar í hverjum flokki.**
```{r}
laun_tafla <- eh %>%
  group_by(Country, EdLevel) %>%
  summarise(
    medallaun = mean(CompTotalUSD, na.rm = TRUE),
    midlaun = median(CompTotalUSD, na.rm = TRUE),
    stadalfravik_launa = sd(CompTotalUSD, na.rm = TRUE),
    count = n(),
    .groups = "drop"
  ) %>%
  arrange(Country, EdLevel) %>%
  rename(
    `Meðallaun` = medallaun,
    `Miðgildi` = midlaun,
    `Staðalfrávik` = stadalfravik_launa,
    `Fjöldi svarenda` = count,
    `Land` = Country,
    `Menntunarstig` = EdLevel
  )

# Birta töflu
kable(laun_tafla, format = "html", digits = 0, caption="<center>Laun eftir menntun og landi í USD</center>") %>%
  kable_styling(
    full_width = FALSE, 
    bootstrap_options = c("striped", "hover", "bordered"),
    position = "center",
    font_size = 16
  ) %>%
  column_spec(1, bold = TRUE) %>%  # Bold Country column
  column_spec(2, bold = TRUE) %>%  # Bold EdLevel column
  row_spec(0, background = "#f2f2f2", bold = TRUE) %>%
  collapse_rows(columns = 1:2, valign = "top")
```

# Notkun á gervigreind. 
**Lýsið í nokkrum orðum hvort og ef já, hvernig, þið notuðuð gervigreind við lausn á þessu verkefni.**

Við notuðum gervigreind þegar við lentum í því að R kóðinn okkar virkaði ekki og við skildum ekki hvað olli því. Þá fengum við gervigreind til að bera kennsl á villuna og útskýra fyrir okkur hvernig betur mætti fara.
